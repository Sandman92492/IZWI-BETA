{% extends 'base.html' %}

{% block title %}iZwi - Alert History{% endblock %}

{% block content %}
<div class="flex flex-col min-h-screen">
  <header class="bg-gradient-to-r from-primary to-primary/80 text-white px-4 sm:px-6 py-4 sm:py-6 md:hidden">
    <div class="flex items-center justify-between mb-3 sm:mb-4">
      <img alt="iZwi Logo" class="h-6 sm:h-8 w-auto" src="https://lh3.googleusercontent.com/aida-public/AB6AXuB_pOQD51q3I4utHDxslkN1ZBiEl-4EUWUU_FQqCvGSavCkVmN-lbf04w7_Qh8qmxlpIxQojb1JpWBbWB1eiNFCNbgo9wGtZYgh8ApxzdC9NzEOlxHQUWlFF8metjKlTZAyDzSD4QMrQxzEdtnsbwKGkDUezK7Ll1FoufX6C2r39f4Mjp59oBfDyVtQB7yHBri-X5_zV2ASI6UP7U117eycls3T2YarZGCWiS_EwxzQMbhIKeFZw-2DLoO3ygX6j-W3d_i-i1TEpoU"/>
      <div class="flex items-center gap-3">
        <!-- Mobile Hamburger Menu -->
        <button onclick="toggleMobileMenu()" class="lg:hidden p-2 rounded-full hover:bg-white/10 transition-all duration-200 group" id="mobile-menu-button">
          <div class="w-6 h-6 flex flex-col justify-center items-center">
            <span class="bg-white h-0.5 w-6 rounded-full transform transition-all duration-300 origin-center group-hover:bg-white/90" id="hamburger-line-1"></span>
            <span class="bg-white h-0.5 w-6 rounded-full transform transition-all duration-300 origin-center mt-1 group-hover:bg-white/90" id="hamburger-line-2"></span>
            <span class="bg-white h-0.5 w-6 rounded-full transform transition-all duration-300 origin-center mt-1 group-hover:bg-white/90" id="hamburger-line-3"></span>
          </div>
        </button>
      </div>
    </div>
    <div class="space-y-2 sm:space-y-3">
      <h1 class="font-display font-bold text-xl sm:text-2xl leading-tight">{{ community.name }}</h1>
      <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-white/90">
        <div class="flex items-center gap-2">
          <span class="material-symbols-outlined text-base sm:text-lg">group</span>
          <span class="font-medium text-sm sm:text-base">{{ member_count }} {% if member_count == 1 %}member{% else %}members{% endif %}</span>
        </div>
        <div class="hidden sm:flex items-center gap-2">
          <span class="material-symbols-outlined text-lg">verified</span>
          <span class="font-medium">Active Community</span>
        </div>
      </div>
    </div>
  </header>
  <main class="flex-grow p-3 sm:p-4 space-y-3 sm:space-y-4 max-w-3xl mx-auto w-full">
    <form method="GET" class="space-y-3 sm:space-y-0">
      <div class="grid grid-cols-1 sm:grid-cols-4 gap-3">
        <input type="text" name="q" placeholder="Search description" value="{{ q }}" class="sm:col-span-2 w-full bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-2 sm:p-3 text-sm sm:text-base" />
        <select name="category" class="w-full bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-2 sm:p-3 text-sm sm:text-base">
          <option value="">All categories</option>
          {% for c in categories %}
          <option value="{{ c }}" {% if selected_category==c %}selected{% endif %}>{{ c }}</option>
          {% endfor %}
        </select>
        <label class="inline-flex items-center gap-2 justify-self-start sm:justify-self-end text-sm">
          <input type="checkbox" name="resolved" value="1" {% if include_resolved %}checked{% endif %} class="rounded" />
          <span>Include resolved</span>
        </label>
      </div>
      <div class="flex justify-end">
        <button class="btn btn-primary px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base">Filter</button>
      </div>
    </form>

    <div class="space-y-3">
      {% for a in alerts %}
      <div class="bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-3 sm:p-4">
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2">
          <div class="flex items-center gap-2">
            <span class="material-symbols-outlined text-primary">notifications_active</span>
            <span class="font-semibold text-gray-900 dark:text-white text-sm sm:text-base">{{ a.category }}</span>
          </div>
          <span class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">{{ a.time_ago }}</span>
        </div>
        <p class="mt-2 text-sm sm:text-base text-gray-800 dark:text-gray-200">{{ a.description }}</p>
        <div class="mt-2 text-xs sm:text-sm text-gray-500 dark:text-gray-400">By {{ a.author_name }}</div>
        {% if a.is_resolved %}
        <div class="mt-2 inline-flex items-center gap-1 text-xs px-2 py-1 rounded bg-emerald-600 text-white w-fit">
          <span class="material-symbols-outlined text-xs">check_circle</span> Resolved
        </div>
        {% endif %}
      </div>
      {% endfor %}
      {% if not alerts %}
      <p class="text-center text-gray-500 dark:text-gray-400">No alerts found.</p>
      {% endif %}
    </div>

    {% if pages and pages > 1 %}
    <div class="flex flex-wrap items-center justify-center gap-1 sm:gap-2 pt-2">
      {% set prev = page-1 %}{% set next = page+1 %}
      <a class="px-2 sm:px-3 py-1 text-xs sm:text-sm rounded border border-gray-200 dark:border-gray-700 {{ 'opacity-50 pointer-events-none' if page<=1 }}" href="?q={{ q }}&category={{ selected_category }}&resolved={{ 1 if include_resolved else 0 }}&page={{ 1 }}">First</a>
      <a class="px-2 sm:px-3 py-1 text-xs sm:text-sm rounded border border-gray-200 dark:border-gray-700 {{ 'opacity-50 pointer-events-none' if page<=1 }}" href="?q={{ q }}&category={{ selected_category }}&resolved={{ 1 if include_resolved else 0 }}&page={{ prev }}">Prev</a>
      <span class="px-2 sm:px-3 py-1 text-xs sm:text-sm">Page {{ page }} of {{ pages }}</span>
      <a class="px-2 sm:px-3 py-1 text-xs sm:text-sm rounded border border-gray-200 dark:border-gray-700 {{ 'opacity-50 pointer-events-none' if page>=pages }}" href="?q={{ q }}&category={{ selected_category }}&resolved={{ 1 if include_resolved else 0 }}&page={{ next }}">Next</a>
      <a class="px-2 sm:px-3 py-1 text-xs sm:text-sm rounded border border-gray-200 dark:border-gray-700 {{ 'opacity-50 pointer-events-none' if page>=pages }}" href="?q={{ q }}&category={{ selected_category }}&resolved={{ 1 if include_resolved else 0 }}&page={{ pages }}">Last</a>
    </div>
    {% endif %}
  </main>
</div>
{% endblock %}


